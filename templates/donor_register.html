{% extends "base.html" %}
{% block title %}Register Donor — HemoBank{% endblock %}
{% block page_title %}Register Donor{% endblock %}
{% block page_subtitle %}Add a new blood donor to the system{% endblock %}

{% block content %}
<div style="max-width:900px;">

    <!-- Form Header -->
    <div style="background:white;border-radius:16px;border:1px solid #e8eaed;box-shadow:0 2px 12px rgba(0,0,0,0.06);overflow:hidden;margin-bottom:24px;">
        <div style="padding:28px 32px;border-bottom:1px solid #f0f0f0;display:flex;align-items:center;gap:18px;">
            <div style="width:52px;height:52px;background:#fef2f2;border-radius:14px;display:flex;align-items:center;justify-content:center;flex-shrink:0;">
                <svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="#e63946" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                    <circle cx="12" cy="7" r="4"/>
                    <line x1="12" y1="17" x2="12" y2="23"/>
                    <line x1="9" y1="20" x2="15" y2="20"/>
                </svg>
            </div>
            <div>
                <h2 style="font-family:'Playfair Display',serif;font-size:1.3rem;color:#0f1117;margin-bottom:3px;">Register New Donor</h2>
                <p style="font-size:0.83rem;color:#9ca3af;">Fill in the donor information below</p>
            </div>
        </div>

        <form id="donorForm" style="padding:32px;">

            <!-- Personal Information -->
            <div style="margin-bottom:28px;">
                <h3 style="font-size:0.78rem;font-weight:700;letter-spacing:0.1em;text-transform:uppercase;color:#e63946;margin-bottom:20px;padding-bottom:10px;border-bottom:2px solid #fef2f2;">Personal Information</h3>
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;">
                    <div>
                        <label style="display:block;font-size:0.83rem;font-weight:600;color:#374151;margin-bottom:7px;">Full Name <span style="color:#e63946;">*</span></label>
                        <input type="text" name="name" required placeholder="Enter full name"
                            style="width:100%;padding:12px 16px;border:1.5px solid #e8eaed;border-radius:10px;font-size:0.9rem;font-family:'DM Sans',sans-serif;color:#0f1117;background:#fafbff;transition:border-color 0.15s;"
                            onfocus="this.style.borderColor='#e63946';this.style.boxShadow='0 0 0 3px rgba(230,57,70,0.09)'"
                            onblur="this.style.borderColor='#e8eaed';this.style.boxShadow='none'">
                    </div>
                    <div>
                        <label style="display:block;font-size:0.83rem;font-weight:600;color:#374151;margin-bottom:7px;">Age <span style="color:#e63946;">*</span></label>
                        <input type="number" name="age" min="18" max="65" required placeholder="18 – 65"
                            style="width:100%;padding:12px 16px;border:1.5px solid #e8eaed;border-radius:10px;font-size:0.9rem;font-family:'DM Sans',sans-serif;color:#0f1117;background:#fafbff;"
                            onfocus="this.style.borderColor='#e63946';this.style.boxShadow='0 0 0 3px rgba(230,57,70,0.09)'"
                            onblur="this.style.borderColor='#e8eaed';this.style.boxShadow='none'">
                    </div>
                    <div>
                        <label style="display:block;font-size:0.83rem;font-weight:600;color:#374151;margin-bottom:7px;">Email Address <span style="color:#e63946;">*</span></label>
                        <input type="email" name="email" required placeholder="email@example.com"
                            style="width:100%;padding:12px 16px;border:1.5px solid #e8eaed;border-radius:10px;font-size:0.9rem;font-family:'DM Sans',sans-serif;color:#0f1117;background:#fafbff;"
                            onfocus="this.style.borderColor='#e63946';this.style.boxShadow='0 0 0 3px rgba(230,57,70,0.09)'"
                            onblur="this.style.borderColor='#e8eaed';this.style.boxShadow='none'">
                    </div>
                    <div>
                        <label style="display:block;font-size:0.83rem;font-weight:600;color:#374151;margin-bottom:7px;">Phone Number <span style="color:#e63946;">*</span></label>
                        <input type="tel" name="phone" required placeholder="10-digit number"
                            style="width:100%;padding:12px 16px;border:1.5px solid #e8eaed;border-radius:10px;font-size:0.9rem;font-family:'DM Sans',sans-serif;color:#0f1117;background:#fafbff;"
                            onfocus="this.style.borderColor='#e63946';this.style.boxShadow='0 0 0 3px rgba(230,57,70,0.09)'"
                            onblur="this.style.borderColor='#e8eaed';this.style.boxShadow='none'">
                    </div>
                    <div>
                        <label style="display:block;font-size:0.83rem;font-weight:600;color:#374151;margin-bottom:7px;">Blood Type <span style="color:#e63946;">*</span></label>
                        <select name="blood_type" required
                            style="width:100%;padding:12px 16px;border:1.5px solid #e8eaed;border-radius:10px;font-size:0.9rem;font-family:'DM Sans',sans-serif;color:#0f1117;background:#fafbff;appearance:none;cursor:pointer;"
                            onfocus="this.style.borderColor='#e63946'" onblur="this.style.borderColor='#e8eaed'">
                            <option value="">Select blood type</option>
                            <option value="A+">A+</option><option value="A-">A-</option>
                            <option value="B+">B+</option><option value="B-">B-</option>
                            <option value="AB+">AB+</option><option value="AB-">AB-</option>
                            <option value="O+">O+</option><option value="O-">O-</option>
                        </select>
                    </div>
                    <div>
                        <label style="display:block;font-size:0.83rem;font-weight:600;color:#374151;margin-bottom:7px;">Emergency Contact</label>
                        <input type="tel" name="emergency_contact" placeholder="Emergency phone number"
                            style="width:100%;padding:12px 16px;border:1.5px solid #e8eaed;border-radius:10px;font-size:0.9rem;font-family:'DM Sans',sans-serif;color:#0f1117;background:#fafbff;"
                            onfocus="this.style.borderColor='#e63946';this.style.boxShadow='0 0 0 3px rgba(230,57,70,0.09)'"
                            onblur="this.style.borderColor='#e8eaed';this.style.boxShadow='none'">
                    </div>
                </div>
            </div>

            <!-- Address Information -->
            <div style="margin-bottom:28px;">
                <h3 style="font-size:0.78rem;font-weight:700;letter-spacing:0.1em;text-transform:uppercase;color:#e63946;margin-bottom:20px;padding-bottom:10px;border-bottom:2px solid #fef2f2;">Address Information</h3>
                <div>
                    <label style="display:block;font-size:0.83rem;font-weight:600;color:#374151;margin-bottom:7px;">Full Address <span style="color:#e63946;">*</span></label>
                    <textarea name="address" rows="3" placeholder="Street, City, State, ZIP"
                        style="width:100%;padding:12px 16px;border:1.5px solid #e8eaed;border-radius:10px;font-size:0.9rem;font-family:'DM Sans',sans-serif;color:#0f1117;background:#fafbff;resize:vertical;"
                        onfocus="this.style.borderColor='#e63946';this.style.boxShadow='0 0 0 3px rgba(230,57,70,0.09)'"
                        onblur="this.style.borderColor='#e8eaed';this.style.boxShadow='none'"></textarea>
                </div>
            </div>

            <!-- Medical Information -->
            <div style="margin-bottom:32px;">
                <h3 style="font-size:0.78rem;font-weight:700;letter-spacing:0.1em;text-transform:uppercase;color:#e63946;margin-bottom:20px;padding-bottom:10px;border-bottom:2px solid #fef2f2;">Medical Information</h3>
                <div style="background:#fef2f2;border:1px solid rgba(230,57,70,0.15);border-radius:12px;padding:20px;display:flex;gap:16px;align-items:flex-start;">
                    <div style="width:36px;height:36px;background:#e63946;border-radius:8px;display:flex;align-items:center;justify-content:center;flex-shrink:0;">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
                    </div>
                    <div>
                        <p style="font-size:0.85rem;font-weight:600;color:#c1121f;margin-bottom:6px;">Eligibility Requirements</p>
                        <div style="display:grid;grid-template-columns:1fr 1fr;gap:4px 24px;">
                            <span style="font-size:0.8rem;color:#6b7280;">✓ Age between 18 and 65 years</span>
                            <span style="font-size:0.8rem;color:#6b7280;">✓ Weight at least 50 kg</span>
                            <span style="font-size:0.8rem;color:#6b7280;">✓ Hemoglobin ≥ 12.5 g/dL</span>
                            <span style="font-size:0.8rem;color:#6b7280;">✓ No donation in last 90 days</span>
                            <span style="font-size:0.8rem;color:#6b7280;">✓ No active infections</span>
                            <span style="font-size:0.8rem;color:#6b7280;">✓ Normal blood pressure</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Actions -->
            <div style="display:flex;gap:14px;justify-content:flex-end;padding-top:20px;border-top:1px solid #f0f0f0;">
                <button type="reset"
                    style="padding:12px 28px;background:transparent;color:#6b7280;border:1.5px solid #e8eaed;border-radius:10px;font-size:0.88rem;font-weight:600;cursor:pointer;font-family:'DM Sans',sans-serif;transition:all 0.15s;"
                    onmouseover="this.style.background='#f5f6fa'" onmouseout="this.style.background='transparent'">
                    Clear Form
                </button>
                <button type="submit"
                    style="padding:12px 32px;background:#e63946;color:white;border:none;border-radius:10px;font-size:0.88rem;font-weight:700;cursor:pointer;font-family:'DM Sans',sans-serif;display:flex;align-items:center;gap:8px;box-shadow:0 4px 14px rgba(230,57,70,0.3);transition:all 0.15s;"
                    onmouseover="this.style.background='#c1121f';this.style.transform='translateY(-1px)'" onmouseout="this.style.background='#e63946';this.style.transform='none'">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                    Register Donor
                </button>
            </div>
        </form>

        <div id="message" class="form-msg hidden"></div>
    </div>

    <!-- Blood Type Reference Cards -->
    <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:12px;">
        {% for bt, note in [('O-','Universal Donor'),('O+','Most Common'),('AB+','Universal Recipient'),('AB-','Rare Type')] %}
        <div style="background:white;border-radius:12px;border:1px solid #e8eaed;padding:18px;text-align:center;">
            <div style="width:44px;height:44px;background:#fef2f2;border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 10px;font-family:'Playfair Display',serif;font-size:1.1rem;font-weight:700;color:#e63946;">{{ bt }}</div>
            <p style="font-size:0.75rem;color:#9ca3af;">{{ note }}</p>
        </div>
        {% endfor %}
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const form = document.getElementById("donorForm");
  const msgBox = document.getElementById("message");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const formData = new FormData(form);
    const payload = {
      name: formData.get("name"),
      age: Number(formData.get("age")),
      email: formData.get("email"),
      phone: formData.get("phone"),
      blood_type: formData.get("blood_type"),
      emergency_contact: formData.get("emergency_contact"),
      address: formData.get("address"),
    };

    msgBox.classList.remove("hidden", "success", "error");
    msgBox.textContent = "Registering donor...";

    try {
      const res = await fetch("/api/donors/register", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(payload),
      });

      const data = await res.json().catch(() => ({}));

      if (!res.ok) {
        throw new Error(data.error || data.message || "Failed to register donor");
      }

      msgBox.classList.add("success");
      msgBox.textContent = data.message || "Donor registered successfully";

      form.reset();
      setTimeout(() => {
        window.location.href = "/donors";
      }, 1200);
    } catch (err) {
      console.error(err);
      msgBox.classList.add("error");
      msgBox.textContent = err.message || "Error registering donor";
    }
  });
});
</script>
{% endblock %}
