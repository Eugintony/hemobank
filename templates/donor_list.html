{% extends "base.html" %}
{% block title %}Donors — HemoBank{% endblock %}
{% block page_title %}Donor List{% endblock %}
{% block page_subtitle %}All registered blood donors{% endblock %}

{% block content %}

<style>
.donor-card {
background:white;
border-radius:14px;
border:1px solid #e8eaed;
padding:24px;
transition:.2s;
box-shadow:0 1px 4px rgba(0,0,0,.05);
}
.donor-card:hover{
transform:translateY(-3px);
box-shadow:0 8px 24px rgba(0,0,0,.1);
border-color:rgba(230,57,70,.25);
}
.donor-avatar{
width:48px;
height:48px;
border-radius:50%;
background:#fef2f2;
color:#e63946;
display:flex;
align-items:center;
justify-content:center;
font-weight:700;
flex-shrink:0;
}
.bt-badge{
display:inline-flex;
align-items:center;
gap:5px;
padding:5px 12px;
background:#fef2f2;
color:#e63946;
border-radius:20px;
font-weight:700;
}
.donor-meta{
display:flex;
align-items:center;
gap:7px;
font-size:.82rem;
color:#6b7280;
margin-bottom:7px;
}
.view-btn{
padding:9px 20px;
background:#e63946;
color:white;
border-radius:8px;
font-weight:700;
text-decoration:none;
}
.view-btn:hover{
background:#c1121f;
}
</style>


<!-- Toolbar -->

<div style="background:white;border-radius:14px;border:1px solid #e8eaed;padding:20px 24px;margin-bottom:22px;box-shadow:0 1px 4px rgba(0,0,0,0.05);">

<div style="display:flex;align-items:center;gap:16px;flex-wrap:wrap;">

<input
type="text"
id="searchInput"
placeholder="Search by name, email, or phone..."
style="flex:1;padding:10px;border:1.5px solid #e8eaed;border-radius:10px;"
>

<select id="bloodFilter" onchange="filterByBlood(this.value)">

<option value="all">All Blood Types</option>

<option>A+</option>
<option>A-</option>
<option>B+</option>
<option>B-</option>
<option>AB+</option>
<option>AB-</option>
<option>O+</option>
<option>O-</option>

</select>

<a href="/donors/register" class="view-btn">

Register Donor

</a>

</div>

<p id="donorCount" style="margin-top:10px;color:#9ca3af">

Loading donors...

</p>

</div>


<!-- GRID -->

<div id="donorGrid"
style="display:grid;grid-template-columns:repeat(2,1fr);gap:16px;">

</div>


<script>

let allDonors=[];

function getInitials(name){

if(!name) return "NA";

return name.split(" ")

.map(n=>n[0])

.join("")

.toUpperCase()

.slice(0,2);

}



function renderDonors(donors){

const grid=document.getElementById("donorGrid");

const cnt=document.getElementById("donorCount");

if(!donors.length){

grid.innerHTML=`

<div style="grid-column:1/-1;text-align:center;padding:50px">

No donors found

</div>

`;

cnt.textContent="0 donors";

return;

}


cnt.textContent=

`Showing ${donors.length} of ${allDonors.length} donors`;


grid.innerHTML=donors.map(d=>`

<div class="donor-card">

<div style="display:flex;justify-content:space-between">

<div style="display:flex;gap:14px">

<div class="donor-avatar">

${getInitials(d.name)}

</div>

<div>

<b>${d.name}</b>

<div>ID : ${d.id}</div>

</div>

</div>

<div class="bt-badge">

${d.blood_type}

</div>

</div>


<div style="margin-top:10px">

<div class="donor-meta">

Email :

${d.email ?? "-"}

</div>

<div class="donor-meta">

Phone :

${d.phone ?? "-"}

</div>

<div class="donor-meta">

Age :

${d.age ?? "-"}

</div>

</div>


<div style="margin-top:12px">

Registered :

${

d.registered_on

? new Date(d.registered_on)

.toLocaleDateString()

:"-"

}

</div>

</div>

`).join("");

}



async function loadDonors(){

try{

// ⭐⭐⭐ FIXED HERE ⭐⭐⭐

const res=await fetch("/api/donors");

if(!res.ok){

throw new Error("API Failed");

}

allDonors=await res.json();

console.log(allDonors);

renderDonors(allDonors);

}

catch(e){

console.log(e);

document.getElementById("donorCount")

.textContent="Failed loading donors";

}

}



function filterByBlood(type){

const filtered=

type==="all"

?allDonors

:allDonors.filter(

d=>d.blood_type===type

);

renderDonors(filtered);

}



document

.getElementById("searchInput")

.addEventListener("input",function(){

const q=this.value.toLowerCase();

renderDonors(

allDonors.filter(d=>

(d.name??"")

.toLowerCase()

.includes(q)

||

(d.email??"")

.toLowerCase()

.includes(q)

||

(d.phone??"")

.includes(q)

)

);

});


document.addEventListener(

"DOMContentLoaded",

loadDonors

);

</script>

{% endblock %}
