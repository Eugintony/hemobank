{% extends "base.html" %}
{% block title %}Inventory — HemoBank{% endblock %}
{% block page_title %}Inventory Management{% endblock %}
{% block page_subtitle %}Real-time blood stock overview{% endblock %}

{% block content %}
<style>
.inv-stat {
    background: white;
    border-radius: 14px;
    border: 1px solid #e8eaed;
    padding: 24px 28px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    box-shadow: 0 1px 4px rgba(0,0,0,0.05);
}
.inv-stat-num { font-family:'Playfair Display',serif; font-size:2.2rem; font-weight:700; line-height:1; }
.inv-stat-icon {
    width: 52px; height: 52px;
    border-radius: 13px;
    display: flex; align-items: center; justify-content: center;
}
.blood-row {
    display: grid;
    grid-template-columns: 80px 1fr 120px 120px 120px 100px;
    align-items: center;
    padding: 18px 24px;
    border-bottom: 1px solid #f5f5f5;
    transition: background 0.15s;
}
.blood-row:hover { background: #fafbff; }
.blood-row:last-child { border-bottom: none; }
.blood-type-circle {
    width: 44px; height: 44px;
    border-radius: 50%;
    background: #fef2f2;
    display: flex; align-items: center; justify-content: center;
    font-family: 'Playfair Display', serif;
    font-size: 0.95rem; font-weight: 700;
    color: #e63946;
}
.stock-status {
    padding: 5px 14px; border-radius: 20px;
    font-size: 0.76rem; font-weight: 700;
    display: inline-block;
}
.s-good     { background:#dcfce7; color:#166534; }
.s-moderate { background:#fef9c3; color:#854d0e; }
.s-low      { background:#fee2e2; color:#991b1b; }
.s-critical { background:#fce7f3; color:#9d174d; }
.upd-btn {
    color: #e63946; font-weight: 700; font-size: 0.82rem;
    background: none; border: none; cursor: pointer;
    font-family: 'DM Sans', sans-serif;
    padding: 6px 12px; border-radius: 6px;
    transition: background 0.15s;
}
.upd-btn:hover { background: #fef2f2; }
</style>

<!-- Top Stats -->
<div style="display:grid;grid-template-columns:repeat(3,1fr);gap:18px;margin-bottom:26px;">
    <div class="inv-stat">
        <div>
            <p style="font-size:0.8rem;color:#9ca3af;margin-bottom:6px;">Total Units</p>
            <p class="inv-stat-num" style="color:#0f1117;" id="totalUnits">—</p>
            <p style="font-size:0.75rem;color:#22c55e;margin-top:6px;">↑ All blood types</p>
        </div>
        <div class="inv-stat-icon" style="background:#eff6ff;">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#1d6fa4" stroke-width="2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg>
        </div>
    </div>
    <div class="inv-stat">
        <div>
            <p style="font-size:0.8rem;color:#9ca3af;margin-bottom:6px;">Expiring Soon</p>
            <p class="inv-stat-num" style="color:#e9850a;" id="expiringSoon">—</p>
            <p style="font-size:0.75rem;color:#e9850a;margin-top:6px;">Within 7 days</p>
        </div>
        <div class="inv-stat-icon" style="background:#fff7ed;">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#e9850a" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
        </div>
    </div>
    <div class="inv-stat">
        <div>
            <p style="font-size:0.8rem;color:#9ca3af;margin-bottom:6px;">Low Stock Types</p>
            <p class="inv-stat-num" style="color:#e63946;" id="lowStockTypes">—</p>
            <p style="font-size:0.75rem;color:#e63946;margin-top:6px;">Requires attention</p>
        </div>
        <div class="inv-stat-icon" style="background:#fef2f2;">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#e63946" stroke-width="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>
        </div>
    </div>
</div>

<!-- Blood Type Inventory Table -->
<div style="background:white;border-radius:16px;border:1px solid #e8eaed;box-shadow:0 2px 12px rgba(0,0,0,0.06);overflow:hidden;">
    <div style="padding:20px 24px;border-bottom:1px solid #f0f0f0;display:flex;align-items:center;justify-content:space-between;">
        <h2 style="font-family:'Playfair Display',serif;font-size:1.15rem;color:#0f1117;">Blood Type Inventory</h2>
        <button onclick="loadInventory()" style="padding:9px 20px;background:#e63946;color:white;border:none;border-radius:9px;font-size:0.82rem;font-weight:700;cursor:pointer;font-family:'DM Sans',sans-serif;display:flex;align-items:center;gap:7px;">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>
            Refresh
        </button>
    </div>

    <!-- Table Header -->
    <div style="display:grid;grid-template-columns:80px 1fr 120px 120px 120px 100px;padding:12px 24px;background:#fafbff;border-bottom:2px solid #f0f0f0;">
        <span style="font-size:0.72rem;font-weight:700;letter-spacing:0.08em;text-transform:uppercase;color:#9ca3af;">Blood Type</span>
        <span style="font-size:0.72rem;font-weight:700;letter-spacing:0.08em;text-transform:uppercase;color:#9ca3af;">Available Units</span>
        <span style="font-size:0.72rem;font-weight:700;letter-spacing:0.08em;text-transform:uppercase;color:#9ca3af;">Stock Status</span>
        <span style="font-size:0.72rem;font-weight:700;letter-spacing:0.08em;text-transform:uppercase;color:#9ca3af;">Expiring Units</span>
        <span style="font-size:0.72rem;font-weight:700;letter-spacing:0.08em;text-transform:uppercase;color:#9ca3af;">Last Updated</span>
        <span style="font-size:0.72rem;font-weight:700;letter-spacing:0.08em;text-transform:uppercase;color:#9ca3af;">Actions</span>
    </div>

    <div id="inventoryRows">
        <!-- Placeholder rows -->
        {% for bt in ['A+','A-','B+','B-','AB+','AB-','O+','O-'] %}
        <div class="blood-row">
            <div class="blood-type-circle">{{ bt }}</div>
            <div>
                <span style="font-family:'Playfair Display',serif;font-size:1.6rem;font-weight:700;color:#0f1117;">—</span>
                <span style="font-size:0.75rem;color:#9ca3af;display:block;">units</span>
            </div>
            <div><span class="stock-status s-good">—</span></div>
            <div style="font-size:0.85rem;color:#6b7280;">—</div>
            <div style="font-size:0.82rem;color:#9ca3af;">—</div>
            <div><button class="upd-btn">Update</button></div>
        </div>
        {% endfor %}
    </div>
</div>

<script>
async function loadInventory() {
    try {
        const stats = await (await fetch('/api/dashboard/stats')).json();

        // Update top stats
        const s = id => document.getElementById(id);
        if (s('totalUnits'))    s('totalUnits').textContent    = stats.available_units ?? '—';
        if (s('expiringSoon'))  s('expiringSoon').textContent  = stats.expiring_soon ?? '—';
        if (s('lowStockTypes')) s('lowStockTypes').textContent = stats.low_stock_types ?? '—';

        if (!stats.blood_availability) return;

        const rows = document.getElementById('inventoryRows');
        const today = new Date().toISOString().slice(0,10);

        rows.innerHTML = stats.blood_availability.map(item => {
            const u = item.units;
            let sc = 'good', sl = 'Good';
            if (u === 0)      { sc='critical'; sl='Critical'; }
            else if (u < 5)  { sc='low';      sl='Low'; }
            else if (u < 15) { sc='moderate'; sl='Moderate'; }

            return `
            <div class="blood-row">
                <div class="blood-type-circle">${item.blood_type}</div>
                <div>
                    <span style="font-family:'Playfair Display',serif;font-size:1.6rem;font-weight:700;color:#0f1117;">${u}</span>
                    <span style="font-size:0.75rem;color:#9ca3af;display:block;">units</span>
                </div>
                <div><span class="stock-status s-${sc}">${sl}</span></div>
                <div style="font-size:0.85rem;color:#6b7280;">${item.expiring_units ? '⚠ ' + item.expiring_units : 'None'}</div>
                <div style="font-size:0.82rem;color:#9ca3af;">${today}</div>
                <div><button class="upd-btn">Update</button></div>
            </div>`;
        }).join('');
    } catch {
        document.getElementById('inventoryRows').innerHTML = `
            <div style="padding:60px;text-align:center;color:#9ca3af;">
                <p>Start Flask backend to see inventory data.</p>
            </div>`;
    }
}
loadInventory();
</script>
{% endblock %}
